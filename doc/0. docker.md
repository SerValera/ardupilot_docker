# Docker manual

### Clone repository
```bash
git clone https://github.com/SerValera/ardupilot_docker.git
cd ardupilot_docker
```

### Allow docker xhost for gui interfaces
``` bash
xhost +local:docker
```

### Create an updated image (if Dockerfile have updates)

```bash
sudo docker-compose build
```

### Create an instance of a container from image (in 'UDH2025_robotics' folder):
``` bash
sudo docker run -it --privileged --ipc=host --net=host \
-v /tmp/.X11-unix:/tmp/.X11-unix:rw \
-v ~/.Xauthority:/home/sim/.Xauthority \
-v ./:/home/sim/ardupilot_docker:rw \
-e DISPLAY=$DISPLAY -p 14570:14570/udp --name=ardupilot ardupilot_docker-drone_sim:latest bash
```


### OR Create an instance of a container from image (in 'ardupilot_docker' folder):
``` bash
sudo docker run -it --privileged --ipc=host --net=host \
--gpus=all \
-v /tmp/.X11-unix:/tmp/.X11-unix:rw \
--env="QT_X11_NO_MITSHM=1" \
-v ~/.Xauthority:/home/sim/.Xauthority \
-v ./:/home/sim/ardupilot_docker:rw \
--runtime=nvidia --gpus all \
-e NVIDIA_DRIVER_CAPABILITIES=all \
-e DISPLAY=$DISPLAY -p 14570:14570/udp --name=px4 ardupilot_docker-drone_sim:latest bash
```

#### To enter the docker use:
``` bash
docker exec -it ardupilot bash
```

### In docker, run ONCE for ardupilot.
``` bash
cd ardupilot
Tools/environment_install/install-prereqs-ubuntu.sh -y
. ~/.profile
git submodule update --init --recursive
```

``` bash
sudo sh -c 'echo "deb http://packages.osrfoundation.org/gazebo/ubuntu-stable `lsb_release -cs` main" > /etc/apt/sources.list.d/gazebo-stable.list'
wget http://packages.osrfoundation.org/gazebo.key -O - | sudo apt-key add -
```